<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ENT INTERNAL APP</title>
<meta name="theme-color" content="#7a1f2b">

<style>
:root{--wine:#7a1f2b;--light:#ffb3b3;--bg:#fff5f5}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg)}

/* Splash */
#splash{position:fixed;inset:0;background:linear-gradient(135deg,#7a1f2b,#ffb3b3);color:white;display:flex;align-items:center;justify-content:center;font-size:42px;font-weight:800;z-index:999;animation:fadeout 1s ease forwards;animation-delay:1.2s}
@keyframes fadeout{to{opacity:0;pointer-events:none}}

/* Pages */
.page{display:none;height:100vh}
.page.active{display:block;animation:fadein .4s ease}
@keyframes fadein{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* Login */
#login{display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center}
#login input,#login select,#login button{width:75%;padding:14px;border-radius:12px;border:1px solid #ddd}
#login button{background:var(--wine);color:white;border:none;font-weight:700}

/* Header */
.top{background:var(--wine);color:white;padding:12px;display:flex;justify-content:space-between;align-items:center}

/* Tabs */
.tab{display:none;padding:10px;height:calc(100vh - 120px);overflow-y:auto}
.tab.active{display:block}

/* Bottom Nav */
.bottom{position:fixed;bottom:0;width:100%;display:flex;border-top:1px solid #ddd;background:white}
.bottom button{flex:1;border:none;background:white;padding:10px;font-size:18px}

/* Widgets */
.widget{display:flex;gap:10px}
.widget div{background:white;padding:10px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.05)}

/* Chat */
#chatBox{height:72%;overflow-y:auto}
.bubble{max-width:75%;padding:10px;margin:6px;border-radius:14px;animation:pop .2s ease}
@keyframes pop{from{transform:scale(.95);opacity:.5}to{transform:scale(1);opacity:1}}
.me{background:var(--wine);color:white;margin-left:auto}
.other{background:#ffe0e0}
.time{font-size:10px;color:#444}
.avatar{width:26px;height:26px;border-radius:50%;vertical-align:middle;margin-right:6px}

.inputBar{display:flex;gap:6px}
.inputBar input{flex:1;padding:12px;border-radius:10px;border:1px solid #ddd}
.inputBar button{background:var(--wine);color:white;border:none;padding:12px;border-radius:10px}

/* Cards */
.card{background:white;padding:12px;border-radius:12px;margin-top:8px;box-shadow:0 4px 10px rgba(0,0,0,.05)}

.badge{background:red;color:white;border-radius:20px;padding:2px 8px;font-size:12px}

.calendarDay{background:white;padding:10px;border-radius:10px;margin:6px 0}

.adminBtn{background:var(--wine);color:white;border:none;padding:6px 10px;border-radius:8px}

.fileItem img{max-width:100%;border-radius:10px;margin-top:6px}
</style>

</head>
<body>

<div id="splash">ENT</div>

<!-- LOGIN -->

<div id="login" class="page active">
<h2>ENT INTERNAL LOGIN</h2>
<input id="code" placeholder="íšŒì‚¬ ì½”ë“œ">
<input id="name" placeholder="ì´ë¦„">
<select id="rank">
<option value="trainee">ì—°ìŠµìƒ</option>
<option value="artist">ì•„í‹°ìŠ¤íŠ¸</option>
<option value="manager">ë§¤ë‹ˆì €</option>
</select>
<input type="file" id="img">
<button onclick="login()">ENTER</button>
</div>

<!-- APP -->

<div id="app" class="page">
<div class="top">
<span>ENT PORTAL</span>
<span id="role"></span>
</div>

<!-- HOME -->

<div id="home" class="tab active">
<div class="widget">
<div>ì ‘ì† <span id="online">0</span></div>
<div>ë©”ì‹œì§€ <span id="msgTotal">0</span></div>
</div>
<h3>ê³µì§€</h3>
<div id="noticeList"></div>
</div>

<!-- CHAT -->

<div id="chat" class="tab">
<select id="roomSel"></select>
<div id="chatBox"></div>
<div class="inputBar">
<input id="chatInput" placeholder="ë©”ì‹œì§€">
<button onclick="sendChat()">ì „ì†¡</button>
</div>
</div>

<!-- COMMUNITY -->

<div id="community" class="tab">
<textarea id="postInput" placeholder="ê²Œì‹œê¸€" style="width:100%;height:80px"></textarea>
<button onclick="addPost()">ë“±ë¡</button>
<div id="postList"></div>
</div>

<!-- FILE BOARD -->

<div id="files" class="tab">
<input type="file" id="fileUpload">
<button onclick="uploadFile()">ì—…ë¡œë“œ</button>
<div id="fileList"></div>
</div>

<!-- DIARY -->

<div id="diary" class="tab">
<textarea id="diaryInput" placeholder="ì—°ìŠµ ì¼ê¸°" style="width:100%;height:80px"></textarea>
<button onclick="saveDiary()">ì €ì¥</button>
<div id="diaryList"></div>
</div>

<!-- CALENDAR -->

<div id="calendar" class="tab">
<input type="date" id="calDate">
<input id="calText" placeholder="ìŠ¤ì¼€ì¤„">
<button onclick="addSchedule()">ì¶”ê°€</button>
<div id="calList"></div>
</div>

<!-- ADMIN -->

<div id="admin" class="tab">
<h3>ê´€ë¦¬ì íŒ¨ë„</h3>
<textarea id="noticeInput" placeholder="ê³µì§€"></textarea>
<button onclick="addNotice()">ê³µì§€ë“±ë¡</button>
<h4>ìœ ì €</h4>
<div id="userList"></div>
<h4>ë¡œê·¸</h4>
<div id="logList"></div>
</div>

<!-- NAV -->

<div class="bottom">
<button onclick="openTab('home')">ğŸ </button>
<button onclick="openTab('chat')">ğŸ’¬ <span id="chatBadge" class="badge">0</span></button>
<button onclick="openTab('community')">ğŸ“°</button>
<button onclick="openTab('files')">ğŸ“‚</button>
<button onclick="openTab('diary')">ğŸ““</button>
<button onclick="openTab('calendar')">ğŸ“†</button>
<button onclick="openTab('admin')">âš™</button>
</div>
</div>

<script>
const COMPANY='12345';
const ADMIN='9999';

let user="";
let avatar="";
let roleRank="";
let isAdmin=false;
let unread=0;

const DB={
 chats:JSON.parse(localStorage.getItem('chats'))||[],
 posts:JSON.parse(localStorage.getItem('posts'))||[],
 diary:JSON.parse(localStorage.getItem('diary'))||[],
 notice:JSON.parse(localStorage.getItem('notice'))||[],
 users:JSON.parse(localStorage.getItem('users'))||[],
 schedule:JSON.parse(localStorage.getItem('schedule'))||[],
 files:JSON.parse(localStorage.getItem('files'))||[],
 logs:JSON.parse(localStorage.getItem('logs'))||[],
 rooms:['ALL','TEAM','DM']
}

function save(){Object.keys(DB).forEach(k=>localStorage.setItem(k,JSON.stringify(DB[k])))}

function log(t){DB.logs.unshift(new Date().toLocaleTimeString()+" - "+t);save()}

function login(){
 if(code.value!==COMPANY && code.value!==ADMIN) return alert('CODE ERROR');
 if(!name.value) return alert('NAME');
 isAdmin=(code.value===ADMIN);
 user=name.value;
 roleRank=rank.value;

 if(img.files[0]){
  const r=new FileReader();
  r.onload=()=>{avatar=r.result;finish()}
  r.readAsDataURL(img.files[0]);
 } else finish();
}

function finish(){
 login.classList.remove('active');
 app.classList.add('active');
 role.innerText=isAdmin?'ADMIN':roleRank.toUpperCase();
 DB.users.push({name:user,rank:roleRank});
 log(user+' LOGIN ('+roleRank+')');
 save();
 roomSel.innerHTML='';
 DB.rooms.forEach(r=>roomSel.innerHTML+=`<option>${r}</option>`);
 renderAll();
}

function openTab(t){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));document.getElementById(t).classList.add('active');if(t==='chat'){unread=0;chatBadge.innerText=0}}

function sendChat(){
 const m=chatInput.value;
 if(!m) return;
 DB.chats.push({room:roomSel.value,user,text:m,avatar,time:new Date().toLocaleTimeString()});
 log('CHAT:'+user);
 save();
 chatInput.value='';
 renderChat();
}

function renderChat(){
 chatBox.innerHTML='';
 DB.chats.filter(c=>c.room===roomSel.value).forEach(c=>{
  const d=document.createElement('div');
  if(c.user===user){d.className='bubble me';d.innerHTML=`${c.text}<div class=time>ì½ìŒ ${c.time}</div>`}
  else{d.className='bubble other';d.innerHTML=`${c.avatar?`<img src='${c.avatar}' class=avatar>`:''}<b>${c.user}</b><br>${c.text}<div class=time>${c.time}</div>`;unread++}
  chatBox.appendChild(d);
 });
 chatBadge.innerText=unread;
 msgTotal.innerText=DB.chats.length;
 online.innerText=DB.users.length;
 chatBox.scrollTop=chatBox.scrollHeight;
}

function addPost(){if(!postInput.value)return;DB.posts.unshift({u:user,t:postInput.value});log('POST:'+user);save();postInput.value='';renderPost()}
function renderPost(){postList.innerHTML='';DB.posts.forEach(p=>postList.innerHTML+=`<div class=card><b>${p.u}</b><br>${p.t}</div>`)}

function uploadFile(){
 const f=fileUpload.files[0];
 if(!f)return;
 const r=new FileReader();
 r.onload=()=>{
  DB.files.unshift({u:user,name:f.name,data:r.result});
  log('FILE:'+user);
  save();
  renderFiles();
 }
 r.readAsDataURL(f);
}

function renderFiles(){
 fileList.innerHTML='';
 DB.files.forEach(f=>{
  fileList.innerHTML+=`<div class='card fileItem'><b>${f.u}</b><br>${f.name}<br>${f.data.startsWith('data:image')?`<img src='${f.data}'>`:`<a href='${f.data}' download='${f.name}'>ë‹¤ìš´ë¡œë“œ</a>`}</div>`;
 })
}

function saveDiary(){if(!diaryInput.value)return;DB.diary.unshift({d:new Date().toLocaleDateString(),t:diaryInput.value});log('DIARY:'+user);save();diaryInput.value='';renderDiary()}
function renderDiary(){diaryList.innerHTML='';DB.diary.forEach(d=>diaryList.innerHTML+=`<div class=card><b>${d.d}</b><br>${d.t}</div>`)}

function addSchedule(){if(!calDate.value||!calText.value)return;DB.schedule.unshift({d:calDate.value,t:calText.value});log('SCHEDULE:'+user);save();renderSchedule()}
function renderSchedule(){calList.innerHTML='';DB.schedule.forEach(s=>calList.innerHTML+=`<div class=calendarDay>${s.d} - ${s.t}</div>`)}

function addNotice(){if(!isAdmin)return alert('ADMIN ONLY');if(!noticeInput.value)return;DB.notice.unshift(noticeInput.value);log('NOTICE');save();noticeInput.value='';renderNotice()}
function renderNotice(){noticeList.innerHTML='';DB.notice.forEach(n=>noticeList.innerHTML+=`<div class=card>${n}</div>`)}

function renderUsers(){userList.innerHTML='';DB.users.forEach((u,i)=>userList.innerHTML+=`<div class=card>${u.name} (${u.rank}) <button class=adminBtn onclick=kick(${i})>ì°¨ë‹¨</button></div>`)}
function kick(i){if(!isAdmin)return;log('KICK:'+DB.users[i].name);DB.users.splice(i,1);save();renderUsers()}

function renderLog(){logList.innerHTML='';DB.logs.forEach(l=>logList.innerHTML+=`<div class=card>${l}</div>`)}

function renderAll(){renderChat();renderPost();renderFiles();renderDiary();renderNotice();renderUsers();renderSchedule();renderLog()}
</script>

</body>
</html>
